# Система управления взаимоотношениями с клиентами

## Overall Description

Разрабатываемая система представляет собой корпоративную CRM-платформу, предназначенную для автоматизации процессов продаж, ведения клиентской базы и анализа взаимодействий. Продукт позволит компаниям централизованно хранить информацию о клиентах, управлять сделками и отслеживать эффективность работы отдела продаж.

## Product Functions

-   Аутентификация и авторизация пользователей на основе ролей.
-   Управление профилем пользователя.
-   Управление компаниями (Accounts).
-   Управление контактами (Contacts).
-   Управление сделками (Deals) и их этапами (Sales Pipeline).
-   Управление задачами (Tasks) и событиями (Events) в календаре.
-   Ведение истории взаимодействий с клиентами (Activity Stream).

## User Characteristics

-   **Менеджер по продажам:** Основной пользователь. Работает с клиентами, сделками и задачами. Имеет доступ к своему набору клиентов и сделок.
-   **Администратор:** Управляет пользователями, настраивает систему (например, этапы воронки продаж), имеет доступ ко всем данным.
-   **Руководитель отдела продаж:** Просматривает аналитику и отчеты по всем менеджерам и сделкам.

## System Features

### Управление компаниями

#### Description and Priority

Позволяет пользователям создавать, просматривать, редактировать и удалять записи о компаниях-клиентах. Приоритет: Высокий.

#### Stimulus/Response Sequences

-   **Сценарий 1:** Добавление новой компании
    *   *Стимул:* Пользователь нажимает "Добавить компанию", вводит название, отрасль, сайт, телефон и сохраняет.
    *   *Ответ:* Система валидирует данные (название обязательно) и создает новую запись в БД.
-   **Сценарий 2:** Поиск компании
    *   *Стимул:* Пользователь вводит название компании в строку поиска.
    *   *Ответ:* Система отображает список компаний, чьи названия соответствуют введенному запросу.

#### Functional Requirements

-   **ACC-1**: Пользователь должен иметь возможность создавать новую компанию с обязательными (название) и необязательными полями.
-   **ACC-2**: Пользователь должен иметь возможность прикреплять несколько контактов к одной компании.
-   **ACC-3**: Система должна предоставлять функцию полнотекстового поиска по названию компании.
-   **ACC-4**: Пользователь должен иметь возможность назначать компанию конкретному менеджеру (владельцу).

### Управление контактами

#### Description and Priority

Позволяет пользователям управлять физическими лицами — представителями компаний. Контакт всегда привязан к компании. Приоритет: Высокий.

#### Stimulus/Response Sequences

-   **Сценарий 1:** Создание контакта
    *   *Стимул:* В карточке компании пользователь нажимает "Добавить контакт", вводит ФИО, должность, email, телефон.
    *   *Ответ:* Система создает контакт и связывает его с текущей компанией.
-   **Сценарий 2:** Фильтрация контактов
    *   *Стимул:* Пользователь применяет фильтр "Только мои контакты".
    *   *Ответ:* Система отображает только те контакты, которые привязаны к компаниям, где пользователь является владельцем.

#### Functional Requirements

-   **CONT-1**: Пользователь должен иметь возможность создавать, редактировать и удалять контакты.
-   **CONT-2**: Каждый контакт должен быть неразрывно связан с ровно одной компанией.
-   **CONT-3**: Система должна отображать список всех контактов с возможностью сортировки и фильтрации.
-   **CONT-4**: При попытке удаления компании система должна запрашивать подтверждение и, в зависимости от настройки, каскадно удалить или отвязать все связанные контакты.

### Управление сделками

#### Description and Priority

Ядро системы. Позволяет управлять воронкой продаж: создавать сделки, перемещать их по этапам, указывать стоимость и вероятность успеха. Приоритет: Высокий.

#### Stimulus/Response Sequences

-   **Сценарий 1:** Создание сделки
    *   *Стимул:* Пользователь из карточки компании нажимает "Новая сделка", вводит название, сумму, выбирает этап воронки.
    *   *Ответ:* Система создает сделку, связывает ее с компанией и устанавливает этап "Инициация".
-   **Сценарий 2:** Изменение этапа сделки
    *   *Стимул:* Пользователь перетаскивает карточку сделки на доске Канбан из колонки "Переговоры" в колонку "Согласование договора".
    *   *Ответ:* Система обновляет этап сделки в БД и записывает это действие в историю.

#### Functional Requirements

-   **DEAL-1**: Система должна предоставлять интерфейс для визуализации воронки продаж.
-   **DEAL-2**: Этапы воронки продаж (например, "Лид", "Квалификация", "Предложение", "Успех", "Провал") должны настраиваться администратором.
-   **DEAL-3**: Каждая сделка должна быть привязана к одной компании и одному ответственному менеджеру.
-   **DEAL-4**: Система должна автоматически рассчитывать прогнозируемый доход на основе суммы сделки и ее вероятности успеха (заданной на этапе).

### Управление задачами и календарем

#### Description and Priority

Позволяет пользователям ставить задачи себе и другим пользователям, а также планировать события, связанные со сделками и контактами. Приоритет: Средний.

#### Stimulus/Response Sequences

-   **Сценарий 1:** Создание задачи по сделке
    *   *Стимул:* Пользователь в карточке сделки нажимает "Добавить задачу", выбирает "Позвонить контакту", устанавливает дату и время.
    *   *Ответ:* Система создает задачу, привязывает ее к сделке и добавляет уведомление в календарь пользователя.
-   **Сценарий 2:** Просмотр календаря
    *   *Стимул:* Пользователь переходит на вкладку "Календарь".
    *   *Ответ:* Система отображает недельное или месячное представление всех его задач и событий.

#### Functional Requirements

-   **TASK-1**: Пользователь должен иметь возможность создавать задачу с темой, описанием, сроком исполнения, приоритетом и привязкой к сделке/контакту.
-   **TASK-2**: Система должна отображать виджет "Предстоящие задачи" на главном дашборде.
-   **TASK-3**: Система должна отправлять email-уведомления о приближающемся сроке задачи.
-   **TASK-4**: При выполнении задачи система должен запрашивать комментарий о результате и сохранять его в истории связанной сущности.

### Журнал взаимодействий

#### Description and Priority

Функция автоматически записывает и отображает всю историю взаимодействий с конкретным клиентом (компанией или контактом). В журнал попадают создание и изменение сделок, задачи, события, notes (заметки) и т.д. Приоритет: Высокий.

#### Stimulus/Response Sequences

-   **Сценарий 1:** Просмотр журнала взаимодействий
    *   *Стимул:* Пользователь открывает карточку компании или контакта и переходит на вкладку "Журнал взаимодействий".
    *   *Ответ:* Система отображает хронологический список всех событий, связанных с выбранной сущностью (сделки, задачи, заметки, изменения полей).
-   **Сценарий 2:** Добавление заметки вручную
    *   *Стимул:* Пользователь в карточке компании нажимает "Добавить заметку", вводит текст и сохраняет.
    *   *Ответ:* Система создает запись в журнале взаимодействий с типом "Заметка", содержащую текст, автора и временную метку.

#### Functional Requirements

-   **ACT-1**: Система должна автоматически регистрировать все значимые действия по сущностям (создание, изменение, удаление, изменение этапа сделки, создание задачи и т.д.).
-   **ACT-2**: В карточке компании, контакта и сделки должна отображаться вкладка с журналом взаимодействий, отсортированным по дате (сначала новые).
-   **ACT-3**: Пользователь должен иметь возможность добавлять произвольные текстовые заметки в журнал взаимодействий для любой сущности (компания, контакт, сделка).
-   **ACT-4**: Каждая запись в журнале должна содержать тип события, автора (пользователя) и дату/время.

### Управление документами

#### Description and Priority

Функция позволяет прикреплять файлы (документы) к различным сущностям системы (компании, контакты, сделки). Приоритет: Низкий.

#### Stimulus/Response Sequences

-   **Сценарий 1:** Прикрепление договора к сделке
    *   *Стимул:* Пользователь в карточке сделки на этапе "Согласование договора" перетаскивает файл с договором в область "Документы".
    *   *Ответ:* Система загружает файл, сохраняет его в файловое хранилище и создает связь с сделкой. Файл становится доступен для скачивания.
-   **Сценарий 2:** Просмотр документов компании
    *   *Стимул:* Пользователь открывает карточку компании и переходит на вкладку "Документы".
    *   *Ответ:* Система отображает список всех документов, прикрепленных к данной компании и ко всем ее контактам и сделкам (с возможностью фильтрации).

#### Functional Requirements

-   **DOC-1**: Система должна позволять загружать файлы (до 10 МБ каждый) и прикреплять их к компаниям, контактам, сделкам и задачам.
-   **DOC-2**: Для каждого файла система должна хранить оригинальное название, дату загрузки, пользователя, который загрузил, и связь с сущностью.
-   **DOC-3**: Система должна предоставлять возможность скачать прикрепленный файл.
